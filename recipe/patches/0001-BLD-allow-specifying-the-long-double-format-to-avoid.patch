From 08248156eecbe2051470fda0162303a38c65f2fd Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Filipe=20La=C3=ADns?= <lains@riseup.net>
Date: Mon, 14 Aug 2023 15:28:17 +0100
Subject: [PATCH] BLD: allow specifying the long double format to avoid the
 runtime check
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Filipe La√≠ns <lains@riseup.net>
---
 numpy/core/meson.build | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/numpy/core/meson.build b/numpy/core/meson.build
index ccc060aac..a6c37fd23 100644
--- a/numpy/core/meson.build
+++ b/numpy/core/meson.build
@@ -377,7 +377,9 @@ endforeach
 # https://github.com/numpy/numpy/blob/eead09a3d02c09374942cdc787c0b5e4fe9e7472/numpy/core/setup_common.py#L264-L434
 # This port is in service of solving gh-23972
 # as well as https://github.com/mesonbuild/meson/issues/11068
-longdouble_format = meson.get_compiler('c').run(
+longdouble_format = meson.get_external_property('longdouble_format', 'UNKNOWN')
+if longdouble_format == 'UNKNOWN'
+  longdouble_format = meson.get_compiler('c').run(
 '''
 #include <stdio.h>
 #include <string.h>
@@ -456,7 +458,8 @@ int main(void) {
   }
   }
 }
-''').stdout()
+  ''').stdout()
+endif
 if longdouble_format == 'UNKNOWN' or longdouble_format == 'UNDEFINED'
   error('Unknown long double format of size: ' + cc.sizeof('long double').to_string())
 endif
